Create database.

#+BEGIN_SRC sqlite :db changes.db
-- drop table if exists import;
create table import (
  id integer primary key autoincrement,
  created  datetime
);

-- drop table if exists change;
create table change (
  change_id varchar(64),
  author varchar(128),
  verified int,
  code_review int,
  project varchar(128),
  branch varchar(128),
  topic varchar(128),
  subject varchar(128),
  status varchar(16),
  mergeable bool,
  insertions int,
  deletions int,
  created datetime,
  updated datetime,
  import_id int
);
#+END_SRC

Run commands.

#+BEGIN_SRC sh
python download.py && python parse.py
#+END_SRC

Try some queries.

#+BEGIN_SRC sqlite :db changes.db :results replace
select * from import order by id desc limit 10;
#+END_SRC

#+RESULTS:
| 30 | 2017-01-16 09:02:21.504146 |
| 29 | 2017-01-15 09:02:21.502205 |
| 28 | 2017-01-14 09:02:33.235775 |
| 27 | 2017-01-11 09:02:27.516531 |
| 26 | 2017-01-10 09:02:23.400995 |
| 25 | 2017-01-09 09:02:21.234917 |
| 24 | 2017-01-08 09:02:21.032772 |
| 23 | 2017-01-07 09:02:22.023730 |
| 22 | 2017-01-06 09:02:25.690266 |
| 21 | 2017-01-05 09:02:27.301614 |

#+name: review_stat
#+BEGIN_SRC sqlite :db changes.db :results replace
  select date(i.created), count(*), 'total'
  from change c join import i on c.import_id = i.id
  group by i.id;

  select date(i.created), count(*), 'ready'
  from change c join import i on c.import_id = i.id
  where verified > 0 and code_review = 0
  group by i.id;

  select date(i.created), count(*), 'ready_for_cores'
  from change c join import i on c.import_id = i.id
  where verified > 0 and code_review = 1
  group by i.id;

  select date(i.created), count(*), 'verification_failed'
  from change c join import i on c.import_id = i.id
  where verified < 0
  group by i.id;

  select date(i.created), count(*), 'non_mergable'
  from change c join import i on c.import_id = i.id
  where mergeable = 0
  group by i.id;
#+END_SRC

#+BEGIN_SRC sqlite :db changes.db :results replace
select verified, code_review, count(*) from change
where import_id = (select max(id) from import)
group by 1, 2;
#+END_SRC

| -1 | -1 |  82 |
| -1 |  0 | 152 |
| -1 |  1 |  29 |
|  0 | -1 |   1 |
|  0 |  0 |   5 |
|  1 | -1 |  62 |
|  1 |  0 | 241 |
|  1 |  1 | 126 |

Plot stat.

#+BEGIN_SRC python :var stat=review_stat :results file replace
  from doan import r_date_num, plot_date
  datasets = r_date_num(stat, multiple=True)
  return plot_date(
     datasets,
     ls='-',
     title='Nova review stat',
     xlabel='Parsing date',
     ylabel='Number of changes',
     output='review_stat.png')
#+END_SRC

#+RESULTS:
[[file:review_stat.png]]

[[review_stat.png]]

#+BEGIN_SRC sqlite :db changes.db :results replace
select * from change
where import_id = (select max(id) from import)
limit 10;

#+END_SRC
